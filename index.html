<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>MinhasEconomias</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background: radial-gradient(circle at top, #e0f2fe, #f8fafc 40%);
}
.glass {
  background: rgba(255,255,255,.75);
  backdrop-filter: blur(14px);
}
.fade {
  animation: fade .4s ease;
}
@keyframes fade {
  from { opacity: 0; transform: translateY(12px) }
  to { opacity: 1; transform: translateY(0) }
}
</style>
</head>

<body class="min-h-screen text-slate-800">

<!-- LOGIN -->
<div id="loginTela" class="min-h-screen flex items-center justify-center">
  <div class="glass w-full max-w-md p-10 rounded-3xl shadow-2xl fade">
    <h1 class="text-3xl font-extrabold text-center mb-2">üí∞ MinhasEconomias</h1>
    <p class="text-center text-slate-500 mb-8">Controle financeiro inteligente</p>

    <input id="email" placeholder="Email"
      class="w-full p-4 mb-3 rounded-xl border focus:ring-2 focus:ring-emerald-400">

    <input id="senha" type="password" placeholder="Senha"
      class="w-full p-4 mb-6 rounded-xl border focus:ring-2 focus:ring-emerald-400">

    <button id="btnLogin"
      class="w-full bg-gradient-to-r from-emerald-500 to-green-600 text-white p-4 rounded-xl font-semibold shadow">
      Entrar
    </button>

    <button id="btnRegistrar"
      class="w-full mt-3 p-3 rounded-xl text-sm text-slate-600 hover:underline">
      Criar conta gratuita
    </button>

    <p id="msg" class="text-center text-red-500 text-sm mt-4"></p>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden max-w-7xl mx-auto px-6 py-10 fade">

<header class="flex justify-between items-center mb-10">
  <div>
    <h2 class="text-sm uppercase tracking-wide text-slate-500">Saldo atual</h2>
    <h1 class="text-5xl font-extrabold text-emerald-600">
      R$ <span id="saldo">0,00</span>
    </h1>
  </div>
  <button id="btnLogout" class="text-sm text-slate-500 hover:text-red-500">
    Sair
  </button>
</header>

<section class="grid md:grid-cols-2 gap-6 mb-10">
  <div class="glass p-6 rounded-2xl shadow">
    <p class="text-slate-500">Entradas</p>
    <h3 class="text-3xl font-bold text-green-600">
      R$ <span id="receitas">0,00</span>
    </h3>
  </div>

  <div class="glass p-6 rounded-2xl shadow">
    <p class="text-slate-500">Sa√≠das</p>
    <h3 class="text-3xl font-bold text-red-500">
      R$ <span id="despesas">0,00</span>
    </h3>
  </div>
</section>

<section class="grid lg:grid-cols-3 gap-8">

<div class="lg:col-span-2 glass p-6 rounded-2xl shadow">
  <h3 class="font-semibold text-lg mb-4">Movimenta√ß√µes</h3>
  <div id="lista" class="space-y-3"></div>
</div>

<div class="glass p-6 rounded-2xl shadow">
  <h3 class="font-semibold text-lg mb-4">Nova movimenta√ß√£o</h3>

  <input id="valor" type="number" step="0.01" placeholder="Valor"
    class="w-full p-3 mb-2 rounded-xl border">

  <input id="descricao" placeholder="Descri√ß√£o"
    class="w-full p-3 mb-2 rounded-xl border">

  <select id="categoria" class="w-full p-3 mb-2 rounded-xl border">
    <option>Alimenta√ß√£o</option>
    <option>Transporte</option>
    <option>Sal√°rio</option>
    <option>Lazer</option>
  </select>

  <select id="tipo" class="w-full p-3 mb-4 rounded-xl border">
    <option value="receita">Entrada</option>
    <option value="despesa">Sa√≠da</option>
  </select>

  <button id="btnSalvar"
    class="w-full bg-emerald-500 hover:bg-emerald-600 text-white p-4 rounded-xl font-semibold">
    Salvar
  </button>
</div>

</section>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient(
  "https://jkzsorzwtyeynnwirwrf.supabase.co",
  "sb_publishable_oaPD0x48PzcvVNsMw1xr4A_jb5zSb4G"
);

const $ = id => document.getElementById(id);
let user = null;

/* AUTH */
$("btnLogin").onclick = async () => {
  const { error } = await supabase.auth.signInWithPassword({
    email: $("email").value,
    password: $("senha").value
  });
  if (error) $("msg").innerText = error.message;
};

$("btnRegistrar").onclick = async () => {
  const { error } = await supabase.auth.signUp({
    email: $("email").value,
    password: $("senha").value
  });
  $("msg").innerText = error ? error.message : "Conta criada!";
};

$("btnLogout").onclick = async () => {
  await supabase.auth.signOut();
  location.reload();
};

/* SESSION */
supabase.auth.onAuthStateChange((_, session) => {
  if (session) {
    user = session.user;
    $("loginTela").classList.add("hidden");
    $("app").classList.remove("hidden");
    carregar();
  }
});

/* CREATE */
$("btnSalvar").onclick = async () => {
  if (!user) return;

  const { error } = await supabase.from("transacoes").insert({
    user_id: user.id,
    valor: Number($("valor").value),
    descricao: $("descricao").value,
    categoria: $("categoria").value,
    tipo: $("tipo").value
  });

  if (error) return alert(error.message);

  $("valor").value = "";
  $("descricao").value = "";
  carregar();
};

/* DELETE */
window.excluir = async id => {
  if (!confirm("Excluir transa√ß√£o?")) return;
  await supabase.from("transacoes").delete().eq("id", id);
  carregar();
};

/* READ */
async function carregar() {
  const { data, error } = await supabase
    .from("transacoes")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending: false });

  if (error) return alert(error.message);

  let r = 0, d = 0;
  $("lista").innerHTML = "";

  data.forEach(t => {
    t.tipo === "receita" ? r += t.valor : d += t.valor;

    $("lista").innerHTML += `
      <div class="flex justify-between items-center p-3 rounded-xl hover:bg-slate-50 group">
        <div>
          <p class="font-medium">${t.descricao}</p>
          <span class="text-xs text-slate-500">${t.categoria}</span>
        </div>
        <div class="flex items-center gap-4">
          <span class="${t.tipo === "receita" ? "text-green-600" : "text-red-500"} font-semibold">
            ${t.tipo === "receita" ? "+" : "-"} R$ ${t.valor.toFixed(2)}
          </span>
          <button onclick="excluir(${t.id})"
            class="opacity-0 group-hover:opacity-100 text-red-500">‚úï</button>
        </div>
      </div>`;
  });

  $("receitas").innerText = r.toFixed(2);
  $("despesas").innerText = d.toFixed(2);
  $("saldo").innerText = (r - d).toFixed(2);
}
</script>

</body>
</html>
